# Very Unofficial Parser

![Coverage][coverage-badge] [![style: very good analysis][very_good_analysis_badge]][very_good_analysis_link] [![License: MIT][license_badge]][license_link]

Fan-made, handmade, recursive-descent parser for the Dart programming language.

Although this parser strives to parse the language according to the language specification, no guarantees can be made that it is perfect. Filing an issue, sending us valid code that should parse (but doesn't), and opening pull requests is all greatly appreciated ‚Äî if you're into this sort of thing.

> üë∑ **Note:** Implementing a parser for the Dart programming language is a large undertaking. As such, **this project is still under development.** Many of the basic tokens in the lexer have already been implemented, and the basic skeleton for parsing expressions with respect for operator precedence has also been constructed. For a full list of everything that *has* been accomplished, see below.
>
> If you want development to finish faster, [please help](#contributing)!

## Features

A checklist of the implemented features is provided below.

### Lexer

#### Comments 

- [x] Single line comments
- [x] Documentation comments
- [x] Multiline comments

#### Numbers

- [x] Hexadecimal numbers
- [x] Decimal numbers (w/ exponents, etc)

#### Strings

- [x] Raw single line strings.
- [x] Raw multiline strings.
- [x] Single line strings with simple string interpolation.
- [x] Single line strings with complex string interpolation.
- [x] Multiline strings with simple string interpolation.
- [x] Multiline strings with complex string interpolation.

#### Misc

- [x] Whitespace
- [x] Newlines  
- [x] Operators
- [x] Braces, brackets, parenthesis, etc.

### Parser

#### Expressions

- [x] Operator precedence parsing

#### Primitives

- [x] Numbers
- [x] Booleans
- [x] Raw strings, single and multiline simple interpolated strings
- [ ] Single and multiline strings with complex interpolation (in progress)

#### Misc

- [x] Special handling for trivia tokens

## Dart Analyzer and Historical Issues 

Dart's analyzer API's are tied to certain platforms and not technically intended for public use (although that never stopped anyone).

The [analyzer] package README says the following:

> The APIs in this package were originally machine generated by a translator and were based on an earlier Java implementation. Several of the API's still look like their Java predecessors rather than clean Dart APIs.
>
> In addition, there is currently no clean distinction between public and internal APIs. We plan to address this issue but doing so will, unfortunately, require a large number of breaking changes. We will try to minimize the pain this causes for our clients, but some pain is inevitable.

No one wants to use a dependency that promises "pain is inevitable." If we liked pain, we'd write our own parsers. Er, okay ‚Äî but that's not the point. Either way, it'd be nice if there was a lightweight alternative to the analyzer for situations where the analyzer is too cumbersome (or overkill).

Currently, if you need to programmatically analyze Dart source code (with or without fully resolved types), you have no choice but to use the analyzer packages. In my experience, the analyzer is most often encountered when creating source generators for build_runner (which is notoriously slow and heavy) or creating custom lint rules by working with the analyzer plugin system directly (via unofficial practices). To make matters worse, the [analyzer system completely obliterates the computer's memory usage][analyzer-memory-usage] when loading custom plugins, which makes using custom lint rules nearly impossible in any substantial project.

If the analyzer is improved substantially within our lifetime, this project probably won't be needed.

## Potential Uses

Wondering what could be done with this once it's finished? Allow me to offer a few ideas, roughly ranked from "barely reasonable" to "rather implausible":

- Create automatic code migration tools.
- Create a lightweight source generator or linting system that provides just an AST (no fully resolved types) for the sake of simplicity and performance. 
- Create a transpiler ‚Äî i.e., compile Dart code to another language.
- Create an interpreter so you can run Dart inside Dart.
- Create a compiler, in case you don't like the official one.
- etc.

## Contributing

We would love your help! If you ~~like pain~~ love making programming languages, you might just enjoy converting the Dart language specification into code. Please strive for readability over conciseness, and don't forget the tests!

Source code for recursive descent parsers are really easy to read and maintain. Handwriting the parser and node descriptions helps ensure they are ergonomic and easy to work with. 

## Credits

You're probably wondering who would do a thing like this. [Me][me], apparently‚Äîbut I blame [Bob][bob]. In fact, if Bob's book _[Crafting Interpreters][crafting-interpreters]_ hadn't made it so easy to understand how to build a programming language, I might have gotten a lot more sleep. 

### Programming Language Theory

In case you're wondering what this is all about, here's a list of some helpful books and guides on some programming language topics.

- *[Crafting Interpreters][crafting-interpreters]* by Bob Nystrom
- *[Pratt Parsing: Expression Parsing Made Easy][pratt]* by Bob Nystrom
- *[Writing an Interpreter in Go][go-interpreter]* by Thorsten Ball
- *[Writing a Compiler in Go][go-compiler]* by Thorsten Ball
- *[Compilers: Principles, Techniques, and Tools][compilers]* by Alfred V. Aho, Ravi Sethi, and Jeffrey D. Ullman (The Dragon Book ‚Äî both editions are great).
- *[Modern Compiler Implementation in Java][modern-compilers]* by Andrew W. Appel

Made with blood, sweat, and tears by üê¥ Very Unofficial Ventures.

<!-- Links -->

[coverage-badge]: coverage_badge.svg
[very_good_analysis_badge]: https://img.shields.io/badge/style-very_good_analysis-B22C89.svg
[very_good_analysis_link]: https://pub.dev/packages/very_good_analysis
[license_badge]: https://img.shields.io/badge/license-MIT-blue.svg
[license_link]: https://opensource.org/licenses/MIT
[me]: https://twitter.com/joannanyana
[bob]: https://twitter.com/munificentbob
[analyzer]: https://pub.dev/packages/analyzer
[analyzer-memory-usage]: https://github.com/dart-lang/sdk/issues/41793#issuecomment-1245676484
[crafting-interpreters]: http://craftinginterpreters.com/
[pratt]: https://journal.stuffwithstuff.com/2011/03/19/pratt-parsers-expression-parsing-made-easy/
[go-interpreter]: https://www.amazon.com/Writing-Interpreter-Go-Thorsten-Ball/dp/3982016118/
[go-compiler]: https://www.amazon.com/Writing-Compiler-Go-Thorsten-Ball/dp/398201610X/
[compilers]: https://www.amazon.com/Compilers-Principles-Techniques-Alfred-Aho/dp/0201100886/
[modern-compilers]: https://www.amazon.com/Modern-Compiler-Implementation-Andrew-Appel/dp/052182060X
